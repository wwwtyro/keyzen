var bigrams = {"gw": 0.000176083799786368, "gv": 3.6142149897231015e-05, "gu": 0.0008946306193989538, "gt": 0.0008622742310772061, "gs": 0.0008859514800691424, "gr": 0.0018031132485869749, "gq": 1.0379659810207911e-05, "gp": 0.00024229482133796896, "gz": 1.575740836832169e-05, "gy": 0.0003483391913998221, "gx": 8.424486579939765e-06, "gg": 0.00029864902483530873, "gf": 0.00022820661213800056, "ge": 0.004272670349355817, "gd": 0.00017430218469207293, "gc": 0.00028890306307987083, "gb": 0.00020485895894712495, "ga": 0.002127397579545536, "go": 0.0016522083242912426, "gn": 0.000703409135016068, "gm": 0.00022193085804777848, "gl": 0.0006013594757890022, "gk": 3.582554289387354e-05, "gj": 2.3742214866799277e-05, "gi": 0.0017997759111384956, "gh": 0.001804673959529322, "tz": 5.9819839614246826e-05, "tx": 5.7564933904442806e-05, "ty": 0.0022807025776465013, "tv": 0.00020515378213903094, "tw": 0.0012169882674552327, "tt": 0.0028816481539723202, "tu": 0.002371095238705705, "tr": 0.004046952686383387, "ts": 0.004493057917394225, "tp": 0.0006718186123541098, "tq": 2.578631712392867e-05, "tn": 0.00041567693576172047, "to": 0.010275902732553329, "tl": 0.0009760317833743448, "tm": 0.0008386066849327197, "tj": 8.045874519787154e-05, "tk": 8.87654216167456e-05, "th": 0.019969082788647414, "ti": 0.011967722985824363, "tf": 0.0005413332738517434, "tg": 0.0002505174688733158, "td": 0.0004843916929552192, "te": 0.012134728107559634, "tb": 0.0005571023887176557, "tc": 0.0011030128377680789, "ta": 0.006347721661439039, "jb": 9.34517476281158e-06, "zl": 2.335531176352588e-05, "zm": 1.2617198403465303e-05, "zn": 8.988973258153082e-06, "zo": 0.00018379892555929193, "zh": 1.4893130147415578e-05, "zi": 0.00021354923363080136, "zj": 4.702711540222517e-06, "zk": 5.574902275372376e-06, "zd": 1.5165887553763015e-05, "ze": 0.000455461927736351, "zf": 6.811610277881662e-06, "zg": 6.03181320838208e-06, "za": 0.00023243738866710016, "jc": 1.6168737384926843e-05, "zc": 1.497013681134115e-05, "zx": 2.407696850044961e-06, "zy": 3.0283842357550626e-05, "zz": 6.100653911161838e-05, "zt": 1.1244390149086841e-05, "zu": 4.447330349745629e-05, "zv": 3.839548323786498e-06, "zw": 8.238308416228144e-06, "zp": 9.029408584954611e-06, "zq": 9.249973948235922e-07, "zr": 1.4293353982471304e-05, "zs": 1.851326334041593e-05, "mv": 3.638646359651082e-05, "mz": 6.245689294375274e-06, "ix": 0.0002170813175981283, "vc": 4.007486930172317e-05, "vh": 2.052463081721116e-05, "vi": 0.0034688883593370703, "vj": 2.312258433683193e-06, "vk": 3.2378731434312067e-06, "vl": 2.0833073763235234e-05, "vm": 1.9109524647897137e-05, "vn": 1.7505224046393037e-05, "vo": 0.0005307216313502822, "me": 0.007639023590640734, "md": 0.00013111645711616886, "mg": 8.632938989174449e-05, "mf": 0.00014665765370548196, "ma": 0.006035395783703348, "mc": 0.00024386569758928645, "mb": 0.001157418419098655, "mm": 0.0011788563974777524, "ml": 0.0001898355468684234, "mo": 0.0031995499866267537, "mn": 0.00014341567507301844, "mi": 0.0028618498388358247, "mh": 9.97368803180505e-05, "mk": 2.3444244837862344e-05, "mj": 2.7241007900715396e-05, "mu": 0.001003649502086195, "mt": 0.00040691006650705856, "mw": 0.00012795942029775458, "ij": 6.195155217084792e-05, "mq": 6.226071631699375e-06, "mp": 0.0021372586102719696, "ms": 0.0012274052934067728, "mr": 0.0001469154979645185, "vt": 2.8378107837853012e-05, "my": 0.0006178875288360038, "mx": 1.9079945698983304e-05, "vu": 2.8665086872874533e-05, "vv": 1.037442117802024e-05, "vw": 1.7462881609230046e-05, "vx": 7.1678446120613945e-06, "vz": 1.1352959624410413e-06, "fp": 0.00021245163600247362, "fq": 8.95478483458868e-06, "fr": 0.0021646155607987026, "fs": 0.00033258036806414456, "ft": 0.0019744719448510405, "fu": 0.0009237390815482606, "fv": 3.908459317719259e-05, "fw": 0.00012585750105634753, "fx": 1.4185516500536745e-05, "fy": 0.0002584672853982288, "fz": 5.473049510224528e-06, "fa": 0.0017132263987072404, "fb": 0.00011146105922916008, "fc": 0.0002761069262466121, "fd": 0.00013454557481294276, "fe": 0.002014750739745786, "ff": 0.0013382735922446113, "fg": 9.751125479352643e-05, "fh": 0.0001422704740392731, "fi": 0.002961204240540644, "fj": 3.115874505100493e-05, "fk": 2.225540452591195e-05, "fl": 0.00064994177852915, "fm": 0.00018632975994723215, "fn": 9.081126668672378e-05, "fo": 0.004909249330129769, "sz": 2.737366165248079e-05, "sy": 0.0007010517311936781, "sx": 3.6567121004021226e-05, "ss": 0.004659279852224544, "sr": 0.0006564399293902376, "sq": 0.00011250700942469862, "sp": 0.0025500369646430706, "sw": 0.001096157562128263, "sv": 0.00019749357550803302, "su": 0.0027460027904977966, "st": 0.011801883123810407, "sk": 0.000577817118053096, "sj": 0.00010168854918430986, "si": 0.0062185829567684234, "sh": 0.0031964270632786587, "so": 0.004717108325335566, "sn": 0.0006868286455784222, "sm": 0.0010571284764759683, "sl": 0.0008960837557953493, "sc": 0.002531399916018818, "sb": 0.0008326954313203302, "sa": 0.004667814024933249, "sg": 0.00033678667490721735, "sf": 0.001018294043650965, "se": 0.008719457345340707, "sd": 0.0006466616197631154, "wq": 4.090154347969797e-06, "lf": 0.0005345050533351814, "lg": 0.00020795829780701438, "ld": 0.0018935898476863736, "le": 0.007875130473559843, "lb": 0.00047376625380998207, "lc": 0.0006066253990527435, "la": 0.005288648807998187, "ln": 0.00020748724229726628, "lo": 0.004251047061221303, "ll": 0.0054881113183021454, "lm": 0.00044397429092237774, "lj": 4.267573685359645e-05, "lk": 0.0002276725176514075, "lh": 0.00017711877517789202, "li": 0.006781637894438801, "lv": 0.0002703523199690035, "lw": 0.00023237130913692538, "lt": 0.0016354820059703615, "lu": 0.0012907514013660803, "lr": 0.0004033181536604562, "ls": 0.002032233477219104, "lp": 0.0007430311873310141, "lq": 1.6679633542431994e-05, "lz": 1.7267077650004352e-05, "lx": 1.3026210615272754e-05, "ly": 0.0024063742147431397, "yi": 0.0006129283078041286, "yh": 0.00025155954158759275, "yk": 5.658469566836638e-05, "yj": 8.190962190384184e-05, "ym": 0.0005441518473006077, "yl": 0.0004195450141387126, "yo": 0.0030377711501810424, "yn": 0.0003548623298738582, "ya": 0.0010079096860711842, "yc": 0.0006094912996293649, "yb": 0.00041848011501334855, "ye": 0.0010494535021069544, "yd": 0.0003533392468095743, "yg": 0.0001795054346008975, "yf": 0.00034601590359616217, "yy": 5.946952868509953e-05, "yx": 1.1118859054271174e-05, "yz": 3.0400960550260063e-05, "yq": 2.039511490808734e-05, "yp": 0.0007151403355471533, "ys": 0.0015846078416731399, "yr": 0.00048165378418844114, "yu": 0.00012732743252612507, "yt": 0.0009403112924000149, "yw": 0.0003972760310829672, "yv": 8.492337824934519e-05, "em": 0.004463709620601643, "el": 0.005686183184177773, "eo": 0.002214250428807965, "en": 0.011590004658419186, "ei": 0.0024188287490150484, "eh": 0.0008518097997467212, "ek": 0.00037988179915067716, "ej": 0.00017323189552896664, "ee": 0.004115223166463012, "ed": 0.008621792228624884, "eg": 0.0017258395695730479, "ef": 0.0022101847048705213, "ea": 0.008385627868109789, "ec": 0.005971812379617261, "eb": 0.00189872293865972, "ey": 0.001262049093911075, "ex": 0.0020022639466466476, "ez": 8.582059632266333e-05, "eu": 0.0007288315401950424, "et": 0.0064178999999135065, "ew": 0.00299858161466595, "ev": 0.0022452941572053387, "eq": 0.0005177035305261936, "ep": 0.0029136650405222637, "es": 0.014589845153606625, "er": 0.017871070614496443, "rt": 0.00467332836108923, "ru": 0.0012712064293963629, "rv": 0.001056664703723301, "rw": 0.00046829876732958883, "rp": 0.0008940685040915003, "rq": 4.146060504205048e-05, "rr": 0.0012678427806606313, "rs": 0.0047217859777574445, "rx": 2.658202436880187e-05, "ry": 0.002409197758491575, "rz": 4.0630793171340594e-05, "rd": 0.0021557067308478647, "re": 0.016290215565464516, "rf": 0.0006606933644351558, "rg": 0.0010155716684944588, "ra": 0.006915998967192493, "rb": 0.0005753439949653582, "rc": 0.0021404754010164147, "rl": 0.0010099137770869715, "rm": 0.002029186723457097, "rn": 0.0017325474492071856, "ro": 0.006986941583067493, "rh": 0.00034487429761985184, "ri": 0.007218684624512236, "rj": 7.009903089583241e-05, "rk": 0.0011502811159850776, "xj": 4.525618309410276e-06, "xk": 5.8393683537766956e-06, "xh": 4.785765267043852e-05, "xi": 0.0002743877212714378, "xn": 2.0290478529332988e-05, "xo": 6.903009973561596e-05, "xl": 3.216031438093408e-05, "xm": 7.500428454208437e-05, "xb": 4.5906989077098825e-05, "xc": 0.00024370718946524933, "xa": 0.00025761404913944455, "xf": 5.0897478354119774e-05, "xg": 2.0259392270665617e-05, "xd": 3.143043857099525e-05, "xe": 0.00023294949636885472, "xz": 3.5052815864145816e-06, "xx": 8.315872132669295e-05, "xy": 5.587391539679996e-05, "xr": 3.1701400847129e-05, "xs": 6.121786258990564e-05, "xp": 0.0005064288369301283, "xq": 3.1052138451256972e-06, "xv": 2.3032106775932492e-05, "xw": 2.315978378214765e-05, "xt": 0.0005439617216493039, "xu": 6.10831305345676e-05, "zb": 1.2359417854686856e-05, "kc": 0.00010786729863516621, "kb": 0.0001380474134970093, "ka": 0.0005112390976821058, "kg": 7.065255161451409e-05, "kf": 0.00012873940654924411, "ke": 0.0021165610201952117, "kd": 6.664457975183837e-05, "kk": 3.180730573459886e-05, "kj": 2.9670056831521628e-05, "ki": 0.001291532971979259, "kh": 0.00015927170767042015, "ko": 0.0003387046127146123, "kn": 0.00036404350918557867, "km": 0.00010775109921933191, "kl": 0.0001861095894376446, "ks": 0.0009321287643384959, "kr": 0.00011099968408088829, "kq": 5.554389371140224e-06, "kp": 0.00010559542006288338, "kw": 9.055838942931564e-05, "kv": 2.0592211211160393e-05, "ku": 0.0001017806997016339, "kt": 0.0003106011980256077, "kz": 5.102749600026449e-06, "ky": 0.00014410577049760905, "kx": 5.30270432004435e-06, "jg": 4.27691819633652e-06, "dn": 0.0003851653788504901, "do": 0.0026543401736757416, "dl": 0.0005363207208878548, "dm": 0.0006162800694049495, "dj": 0.00012285746610156227, "dk": 7.504696891595028e-05, "dh": 0.00041984691351655654, "di": 0.004992251509505943, "df": 0.0005569659777096334, "dg": 0.00042291000663621743, "dd": 0.000976489760142496, "de": 0.006947310253189808, "db": 0.000922667369622661, "dc": 0.0006683920004942172, "da": 0.003489785209766986, "dz": 1.327811992647716e-05, "dx": 1.9188333937360874e-05, "dy": 0.0004815244775487769, "dv": 0.0005362211505989185, "dw": 0.0005787233356126145, "dt": 0.0016454869742098504, "du": 0.0015353778692935726, "dr": 0.0011681847585015602, "ds": 0.002115643861860452, "dp": 0.0005299083567137921, "dq": 3.3882960609484954e-05, "qq": 2.4816461711139094e-06, "qp": 5.367530482059056e-06, "qs": 2.034519754609532e-05, "qr": 1.2338489259758878e-05, "qu": 0.0012414364203141694, "qt": 1.3856638901468119e-05, "qw": 5.7957062897852255e-06, "qv": 2.353098358100316e-06, "qy": 1.0345751411966196e-06, "qx": 1.1519723098833135e-06, "qz": 6.436947189395527e-07, "qa": 1.7651308220380084e-05, "qc": 7.846289903901575e-06, "qb": 3.7564761434762865e-06, "qe": 3.7923133885204627e-06, "qd": 4.258427980369357e-06, "qg": 2.2928443440202528e-06, "qf": 6.374196632636659e-06, "qi": 1.4882956143868816e-05, "qh": 4.394225720942397e-06, "qk": 1.2177013586852438e-06, "qj": 1.041074636868826e-06, "qm": 5.185613110503054e-06, "ql": 3.111821918068365e-05, "qo": 3.754829570593857e-06, "qn": 4.3243650993789365e-06, "jx": 8.517952076991112e-07, "jy": 1.6311190224108359e-06, "jz": 1.2097794003326498e-06, "jt": 6.680892718336724e-06, "ju": 0.0006078214747513238, "jv": 6.449849341147619e-06, "wg": 3.450617795203041e-05, "wf": 7.671655469314042e-05, "we": 0.002807347166669651, "wd": 8.977187445038842e-05, "wc": 0.00011083125739396279, "wb": 8.11751733463424e-05, "wa": 0.0024909430451063135, "wo": 0.0017645295201248125, "wn": 0.000674076596693492, "wm": 0.00010720239259765918, "wl": 0.00014906048579012448, "wk": 2.4388207052599364e-05, "wj": 3.996807786727346e-05, "wi": 0.00322092007850285, "wh": 0.0018051985743792285, "ww": 0.0002941609518054858, "wv": 2.2438799675643027e-05, "wu": 4.284760674268296e-05, "jo": 0.0006789706310382448, "ws": 0.0009222697122278193, "wr": 0.0003062154088919969, "jj": 5.436098459962175e-06, "wp": 0.00012185824235847685, "jd": 1.0817368771237546e-05, "je": 0.0005617711744704837, "jf": 5.588157456907618e-06, "js": 1.7498657392613464e-05, "ja": 0.0006285551991877885, "wy": 0.0001339039651433679, "wx": 1.7128591036726274e-05, "jl": 6.258317117251288e-06, "jm": 1.1385491881077045e-05, "jn": 7.392621748076205e-06, "wt": 0.00027094334519270737, "jh": 6.13517897973007e-06, "ji": 7.254832379862834e-05, "ck": 0.002065805829483322, "cj": 1.4649582020578471e-05, "ci": 0.002265733357963064, "ch": 0.005122366006336058, "co": 0.00786864700933736, "cn": 9.912807348635611e-05, "cm": 0.00011831412479759892, "cl": 0.0017438383463456249, "cc": 0.0008878947011050834, "cb": 6.903176819484588e-05, "ca": 0.005391369842177508, "jk": 1.4276738347157345e-05, "cg": 5.705342657817931e-05, "cf": 7.553305704848152e-05, "ce": 0.005693188130204528, "cd": 0.00023315758741350546, "cz": 2.1243257344352892e-05, "cy": 0.0006033858994238994, "cx": 1.0502547453984908e-05, "cs": 0.0006113809832114952, "cr": 0.001488238623387362, "cq": 3.697024743732514e-05, "cp": 0.0001413813485178928, "cw": 4.711336350142533e-05, "cv": 5.461002799855683e-05, "cu": 0.0014339078238085918, "ct": 0.004332105470454065, "pr": 0.004687422862913915, "ps": 0.0007400874711950489, "pp": 0.0014803369809618728, "pq": 1.5304637702649917e-05, "pv": 2.7915566267185174e-05, "pw": 6.976472788109e-05, "pt": 0.0010345634526878079, "pu": 0.001087897544853828, "pz": 7.724781549735945e-06, "px": 1.30675257432621e-05, "py": 0.00030945934410396347, "wz": 1.528133264014135e-05, "pb": 8.294528611568584e-05, "pc": 0.00021731672265454054, "pa": 0.0037324613112158012, "pf": 0.00011247485897986115, "pg": 8.634276185043518e-05, "pd": 0.0002229678718677489, "pe": 0.0037666224170207784, "pj": 1.1348821905482806e-05, "pk": 2.507050883879255e-05, "ph": 0.0011334944082845564, "pi": 0.0014435397083743693, "pn": 6.166067106990054e-05, "po": 0.0035532748238084715, "pl": 0.0025486527117777394, "pm": 0.0004898456703124837, "iy": 1.8175121670192782e-05, "va": 0.0015082914043403363, "vb": 2.388015237260573e-05, "iz": 0.000514512925897082, "vd": 0.00014222923266527665, "ve": 0.006354031620742352, "vf": 1.0498342127230465e-05, "vg": 2.390229356112857e-05, "iq": 0.00010708716457587788, "ip": 0.001241623722626647, "is": 0.008474415553688473, "ir": 0.002554623763088854, "iu": 0.00015975555664971534, "it": 0.009112289990368512, "iw": 0.0001406040955114292, "iv": 0.0023289431421599257, "ii": 0.0001729770973698, "ih": 0.00012426152970912844, "ik": 0.00045040014323266054, "vs": 7.7586161490128e-05, "im": 0.002319372534270301, "il": 0.0045876244158506545, "io": 0.006875734119447639, "in": 0.02020928565982535, "ia": 0.002854641499234179, "vy": 3.369363276051908e-05, "ic": 0.006845200770180288, "ib": 0.0008849211137025494, "ie": 0.003737715533228679, "id": 0.0026841570580675325, "ig": 0.002436718464469109, "if": 0.00159714213294334, "vr": 3.253857837320835e-05, "jw": 5.230052439643413e-06, "jp": 2.3799116222238085e-05, "jq": 4.2857560833409393e-07, "jr": 2.0601657118886877e-05, "bd": 7.002872145423891e-05, "be": 0.004079358435014612, "bf": 3.276179708135665e-05, "bg": 2.5224398943509193e-05, "ba": 0.002042131527503066, "bb": 0.00017550817025896524, "bc": 0.0001276852587173185, "bl": 0.002122024682561054, "bm": 0.00015899584135338366, "bn": 5.3052611251319986e-05, "bo": 0.0021407210341926166, "bh": 4.8064047673065215e-05, "bi": 0.0013063135544329283, "bj": 0.00020324044766012052, "bk": 1.0528395829997052e-05, "bt": 0.00012157054107398815, "bu": 0.001731526903364637, "bv": 2.283768810257775e-05, "bw": 2.961590131325393e-05, "bp": 6.643227123800756e-05, "bq": 4.090638396024911e-06, "br": 0.001119944774276157, "bs": 0.0006605017984822993, "bx": 9.668748970088998e-06, "by": 0.001477954175184997, "bz": 8.69155428547214e-06, "oo": 0.0026295654075552625, "on": 0.015059871873554686, "om": 0.0057370447584285545, "ol": 0.003530754260935986, "ok": 0.000950051930676192, "oj": 0.00018158170754024048, "oi": 0.0009290076488626665, "oh": 0.00042510307531941057, "og": 0.0014296739605549635, "of": 0.00673805584633413, "oe": 0.0005094572165037916, "od": 0.002182461452589576, "oc": 0.002049504577759665, "ob": 0.0012773433525381003, "oa": 0.0012340649394286104, "oz": 6.76075318208726e-05, "oy": 0.0004834119789421371, "ox": 0.0002519437072484585, "ow": 0.0029940260571823312, "ov": 0.0017633975943600719, "ou": 0.007932124438979367, "ot": 0.004859877248796508, "os": 0.002971351566878413, "or": 0.012891723295021132, "oq": 2.0580014819161624e-05, "op": 0.002859870629748911, "hz": 2.2570178022994386e-05, "hx": 7.438617856111687e-06, "hy": 0.0003911624503304544, "hr": 0.0007213632083242698, "hs": 0.00037749652576307506, "hp": 0.00022395675371201913, "hq": 3.253117464159051e-05, "hv": 4.0267896992760355e-05, "hw": 0.00016586490958950023, "ht": 0.0015784428221576714, "hu": 0.000573170551290259, "hj": 2.8467571131443405e-05, "hk": 3.0326936275946283e-05, "hh": 0.0001169624443638732, "hi": 0.005103103035756373, "hn": 0.0004003162595653862, "ho": 0.004952499716721952, "hl": 0.00021236761896155907, "hm": 0.0002737198460360901, "hb": 0.00015550135648207387, "hc": 0.0002415578738392869, "ha": 0.006177087386487379, "hf": 0.00014149880939683758, "hg": 6.551885112138044e-05, "hd": 0.00015604255533702494, "he": 0.01596482060430723, "uy": 0.00024485418413014345, "ux": 9.078229680787744e-05, "uz": 4.4207454831497835e-05, "uu": 2.5521270457689893e-05, "ut": 0.0033727775197269646, "uw": 0.00010971845654926668, "uv": 6.143734652777054e-05, "uq": 8.936535518350402e-06, "up": 0.0014074124468898784, "us": 0.004598700189681107, "ur": 0.005390286718470477, "um": 0.0015001222725223593, "ul": 0.002361335979794915, "uo": 0.00013656643092081403, "un": 0.003445967546586911, "ui": 0.001044428279196466, "uh": 7.868640152014898e-05, "uk": 0.0002057817909427054, "uj": 2.1776834203837172e-05, "ue": 0.001267852991091455, "ud": 0.0009514187081924914, "ug": 0.0008599837308209647, "uf": 0.00021234771587692688, "ua": 0.001233291013596685, "uc": 0.0016043855265286215, "ub": 0.0010142194912706262, "aa": 0.0002868444455272541, "ac": 0.004796057282076095, "ab": 0.0023064620800971854, "ae": 0.00019004220705563029, "ad": 0.0034781825015835132, "ag": 0.0027610785760064168, "af": 0.0008951868928505051, "ai": 0.0030117648493310123, "ah": 0.0003971686437702211, "ak": 0.0009651825245458423, "aj": 0.00012927956250474663, "am": 0.00343321594697173, "al": 0.00959893122732812, "ao": 0.00014534762868747712, "an": 0.01580351203606238, "aq": 0.0001322790057786172, "ap": 0.0022560818576833944, "as": 0.006528569311078092, "ar": 0.010306980678306219, "au": 0.001290788184820887, "at": 0.012083944613303244, "aw": 0.0006262912161903161, "av": 0.0019041990410156066, "ay": 0.0025107861587478986, "ax": 0.00027440781698590927, "az": 0.00028771384455384704, "nh": 0.00041863948509970124, "ni": 0.0038015186459624587, "nj": 0.00020185149882409384, "nk": 0.0008288672934288171, "nl": 0.0010274412892302472, "nm": 0.0006872259637348777, "nn": 0.001142821008434047, "no": 0.0045898576623212995, "na": 0.004772296766325226, "nb": 0.0005116812961925943, "nc": 0.0037083611719690578, "nd": 0.010196468844658555, "ne": 0.007259409914087557, "nf": 0.0013085631727909356, "ng": 0.008195672154550283, "nx": 3.5220993856204974e-05, "ny": 0.0010717406295443954, "nz": 6.886762463614294e-05, "np": 0.0005385572440145512, "nq": 4.972226888936771e-05, "nr": 0.0003823584459403609, "ns": 0.00486578584651562, "nt": 0.010751323867063397, "nu": 0.001119169804645344, "nv": 0.0005149545785980417, "nw": 0.0004272755732344666, "vp": 2.4070975388899476e-05, "vq": 1.294839640508738e-06};
var alphabet = 'abcdefghijklmnopqrstuvwxyz';
var data = {};
var hits_correct = 0;
var hits_wrong = 0;
var start_time = 0;
var hpm = 0;
var ratio = 0;

data.chars = " jfkdlsahgyturieowpqbnvmcxz6758493021`-=[]\\;',./ABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&*()_+{}|:\"<>?";
data.consecutive = 5;
data.word_length = 7;


$(document).ready(function() {
    if (localStorage.data != undefined) {
        load();
        render();
    }
    else {
        set_level(1);
    }
    $(document).keypress(keyHandler);
});


function start_stats() {
    start_time = start_time || Math.floor(new Date().getTime() / 1000);
}

function update_stats() {
    if (start_time) {
        var current_time = (Math.floor(new Date().getTime() / 1000));
        ratio = Math.floor(
            hits_correct / (hits_correct + hits_wrong) * 100
        );
        hpm = Math.floor(
            (hits_correct + hits_wrong) / (current_time - start_time) * 60
        );
        if (!isFinite(hpm)) { hpm = 0; }
    }
}


function set_level(l) {
    data.in_a_row = {};
    for(var i = 0; i < data.chars.length; i++) {
        data.in_a_row[data.chars[i]] = data.consecutive;
    }
    data.in_a_row[data.chars[l]] = 0;
    data.level = l;
    data.word_index = 0;
    data.word_errors = {};
    data.word = generate_word();
    data.keys_hit = "";
    save();
    render();
}


function keyHandler(e) {
    start_stats();

    var key = String.fromCharCode(e.which);
    if (e.ctrlKey || e.altKey || e.metaKey) {
    	return;
    }
    if (data.chars.indexOf(key) > -1){
        e.preventDefault();
    }
    data.keys_hit += key;
    if(key == data.word[data.word_index]) {
        hits_correct += 1;
        data.in_a_row[key] += 1;
        (new Audio("click.wav")).play();
    }
    else {
        hits_wrong += 1;
        data.in_a_row[data.word[data.word_index]] = 0;
        data.in_a_row[key] = 0;
        (new Audio("clack.wav")).play();
        data.word_errors[data.word_index] = true;
    }
    data.word_index += 1;
    if (data.word_index >= data.word.length) {
        if(get_training_chars().length == 0) {
            level_up();
        }
        data.word = generate_word();
        data.word_index = 0;
        data.keys_hit = "";
        data.word_errors = {};
    }

    update_stats();

    render();
    save();
}


function level_up() {
    if (data.level + 1 <= data.chars.length - 1) {
        (new Audio('ding.wav')).play();
    }
    l = Math.min(data.level + 1, data.chars.length);
    set_level(l);
}


function save() {
    localStorage.data = JSON.stringify(data);
}


function load() {
    data = JSON.parse(localStorage.data);
}


function render() {
    render_level();
    render_word();
    render_level_bar();
    render_rigor();
    render_stats();
}


function render_level() {
    var chars = "<span id='level-chars-wrap'>";
    var level_chars = get_level_chars();
    var training_chars = get_training_chars();
    for (var c in data.chars) {
        if(training_chars.indexOf(data.chars[c]) != -1) {
            chars += "<span style='color: #F00' onclick='set_level(" + c + ");'>"
        }
        else if (level_chars.indexOf(data.chars[c]) != -1) {
            chars += "<span style='color: #000' onclick='set_level(" + c + ");'>"
        }
        else {
            chars += "<span style='color: #AAA' onclick='set_level(" + c + ");'>"
        }
        if (data.chars[c] == ' ') {
            chars += "&#9141;";
        }
        else {
            chars += data.chars[c];
        }
        chars += "</span>";
    }
    chars += "</span>";
    $("#level-chars").html('click to set level: ' + chars);
}

function render_rigor() {
    chars = "<span id='rigor-number' onclick='inc_rigor();'>";
    chars += '' + data.consecutive;
    chars += '<span>';
    $('#rigor').html('click to set required repititions: ' + chars);
}

function render_stats() {
    $("#stats").text([
        "hits per minute: ", hpm, " ",
        "correctness: ", ratio, "%"
    ].join(""));
}

function inc_rigor() {
    data.consecutive += 1;
    if (data.consecutive > 9) {
        data.consecutive = 2;
    }
    render_rigor();
}


function render_level_bar() {
    training_chars = get_training_chars();
    if(training_chars.length == 0) {
        m = data.consecutive;
    }
    else {
        m = 1e100;
        for(c in training_chars) {
            m = Math.min(data.in_a_row[training_chars[c]], m);
        }
    }
    m = Math.floor($('#level-chars-wrap').innerWidth() * Math.min(1.0, m / data.consecutive));
    $('#next-level').css({'width': '' + m + 'px'});
    
}   

function render_word() {
    var word = "";
    for (var i = 0; i < data.word.length; i++) {
        sclass = "normalChar";
        if (i > data.word_index) {
            sclass = "normalChar";
        }
        else if (i == data.word_index) {
            sclass = "currentChar";
        }
        else if(data.word_errors[i]) {
            sclass = "errorChar";
        }
        else {
            sclass = "goodChar";
        }
        word += "<span class='" + sclass + "'>";
        if(data.word[i] == " ") {
            word += "&#9141;"
        }
        else if(data.word[i] == "&") {
            word += "&amp;"
        }
        else {
            word += data.word[i];
        }
        word += "</span>";
    }
    var keys_hit = "<span class='keys-hit'>";
    for(var d in data.keys_hit) {
        if (data.keys_hit[d] == ' ') {
            keys_hit += "&#9141;";
        }
        else if (data.keys_hit[d] == '&') {
            keys_hit += "&amp;";
        }
        else {
            keys_hit += data.keys_hit[d];
        }
    }
    for(var i = data.word_index; i < data.word_length; i++) {
        keys_hit += "&nbsp;";
    }
    keys_hit += "</span>";
    $("#word").html(word + "<br>" + keys_hit);
}


function generate_word() {
    word = '';

    for(var i = 0; i < data.word_length; i++) {
        if(i == 0){
            c = choose(get_training_chars())}
        else{
            perms = permutations(get_training_chars());
            // filter perms to ones which start with previous letter
            keep = [];
            for(var j = 0; j < perms.length ; j++){
                if(perms[j][0] == word[word.length-1]){
                    keep.push(perms[j]);
                }
            }
            if(keep.length > 0){
                c = choose_non_uniform(keep)[1];
            } else {
                c = choose(get_training_chars());
            }      
        }
        if(c != undefined && c != word[word.length-1]) {
            word += c;
        }
        else {
            perms = permutations(get_level_chars());
            // filter perms to ones which start with previous letter
            keep = [];
            for(var j = 0; j < perms.length ; j++){
                if(perms[j][0] == word[word.length-1] && perms[j][1] != ' '){
                    keep.push(perms[j]);
                }
            }
            if(keep.length > 0){
                c = choose_non_uniform(keep)[1];
            } else {
                c = choose(get_level_chars());
            }    
            word += c;
        }
    }
    return word;
}

function choose_non_uniform(values){
    sum = 0;
    for(var i = 0; i< values.length; i++ ){
        sum += bigrams[values[i]];
    }
    normalisation_factor = 1 / sum;
    cumlative = 0;
    cutoff = Math.random()
    for(var i = 0; i < values.length; i++ ){
        normalised = bigrams[values[i]] * normalisation_factor;
        cumlative += normalised;
        if(cumlative > cutoff){
            return values[i];
        }
    }
    return values[i];

}

function permutations(iterable){
    if(iterable.length < 2){ return false; }
    perms = []
    for(var i = 0; i < iterable.length; i++){
        for(var j = 0; j < iterable.length; j++){
            c = iterable[i] + iterable[j];
            d = iterable[j] + iterable[i]; 
            if(perms.indexOf(c) == -1){
                perms.push(c);
            }
            if(perms.indexOf(d) == -1){
                perms.push(d);
            }
        }
    }
    return perms;
}

function get_level_chars() {
    return data.chars.slice(0, data.level + 1).split('');
}

function get_training_chars() {
    var training_chars = [];
    var level_chars = get_level_chars();
    for(var x in level_chars) {
        if (data.in_a_row[level_chars[x]] < data.consecutive) {
            training_chars.push(level_chars[x]);
        }
    }
    return training_chars;
}

function choose(a) {
    return a[Math.floor(Math.random() * a.length)];
}
